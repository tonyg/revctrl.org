<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>OperationalTransformation - Revision Control</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="FrontPage.html"><strong aria-hidden="true">2.</strong> FrontPage</a></li><li class="chapter-item expanded "><a href="Glossary.html"><strong aria-hidden="true">3.</strong> Glossary</a></li><li class="chapter-item expanded "><a href="ConceptTable.html"><strong aria-hidden="true">4.</strong> ConceptTable</a></li><li class="chapter-item expanded "><a href="CategoryMergeAlgorithm.html"><strong aria-hidden="true">5.</strong> CategoryMergeAlgorithm</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="BKMerge.html"><strong aria-hidden="true">5.1.</strong> BKMerge</a></li><li class="chapter-item expanded "><a href="CodevilleMerge.html"><strong aria-hidden="true">5.2.</strong> CodevilleMerge</a></li><li class="chapter-item expanded "><a href="DarcsMerge.html"><strong aria-hidden="true">5.3.</strong> DarcsMerge</a></li><li class="chapter-item expanded "><a href="DieDieDieMerge.html"><strong aria-hidden="true">5.4.</strong> DieDieDieMerge</a></li><li class="chapter-item expanded "><a href="OperationalTransformation.html" class="active"><strong aria-hidden="true">5.5.</strong> OperationalTransformation</a></li><li class="chapter-item expanded "><a href="ScalarMerge.html"><strong aria-hidden="true">5.6.</strong> ScalarMerge</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ConvergentScalarMerge.html"><strong aria-hidden="true">5.6.1.</strong> ConvergentScalarMerge</a></li><li class="chapter-item expanded "><a href="MarkMerge.html"><strong aria-hidden="true">5.6.2.</strong> MarkMerge</a></li><li class="chapter-item expanded "><a href="PreciseCodevilleMerge.html"><strong aria-hidden="true">5.6.3.</strong> PreciseCodevilleMerge</a></li></ol></li><li class="chapter-item expanded "><a href="SimpleWeaveMerge.html"><strong aria-hidden="true">5.7.</strong> SimpleWeaveMerge</a></li><li class="chapter-item expanded "><a href="ThreeWayMerge.html"><strong aria-hidden="true">5.8.</strong> ThreeWayMerge</a></li></ol></li><li class="chapter-item expanded "><a href="CategoryMergeExample.html"><strong aria-hidden="true">6.</strong> CategoryMergeExample</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="AccidentalCleanMerge.html"><strong aria-hidden="true">6.1.</strong> AccidentalCleanMerge</a></li><li class="chapter-item expanded "><a href="CrissCrossMerge.html"><strong aria-hidden="true">6.2.</strong> CrissCrossMerge</a></li><li class="chapter-item expanded "><a href="ImplicitUndo.html"><strong aria-hidden="true">6.3.</strong> ImplicitUndo</a></li><li class="chapter-item expanded "><a href="Rollback.html"><strong aria-hidden="true">6.4.</strong> Rollback</a></li><li class="chapter-item expanded "><a href="StaircaseMerge.html"><strong aria-hidden="true">6.5.</strong> StaircaseMerge</a></li></ol></li><li class="chapter-item expanded "><a href="uncategorised.html"><strong aria-hidden="true">7.</strong> Uncategorised pages</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="AmbiguousCleanMerge.html"><strong aria-hidden="true">7.1.</strong> AmbiguousCleanMerge</a></li><li class="chapter-item expanded "><a href="CategoryCategory.html"><strong aria-hidden="true">7.2.</strong> CategoryCategory</a></li><li class="chapter-item expanded "><a href="Convergence.html"><strong aria-hidden="true">7.3.</strong> Convergence</a></li><li class="chapter-item expanded "><a href="EdgeVersioning.html"><strong aria-hidden="true">7.4.</strong> EdgeVersioning</a></li><li class="chapter-item expanded "><a href="GenerationCounting.html"><strong aria-hidden="true">7.5.</strong> GenerationCounting</a></li><li class="chapter-item expanded "><a href="LivingLinesFirst.html"><strong aria-hidden="true">7.6.</strong> LivingLinesFirst</a></li><li class="chapter-item expanded "><a href="Merging.html"><strong aria-hidden="true">7.7.</strong> Merging</a></li><li class="chapter-item expanded "><a href="NeutralInterface.html"><strong aria-hidden="true">7.8.</strong> NeutralInterface</a></li><li class="chapter-item expanded "><a href="Renaming.html"><strong aria-hidden="true">7.9.</strong> Renaming</a></li><li class="chapter-item expanded "><a href="Resolution.html"><strong aria-hidden="true">7.10.</strong> Resolution</a></li><li class="chapter-item expanded "><a href="RevctrlTalks.html"><strong aria-hidden="true">7.11.</strong> RevctrlTalks</a></li><li class="chapter-item expanded "><a href="StarMerge.html"><strong aria-hidden="true">7.12.</strong> StarMerge</a></li><li class="chapter-item expanded "><a href="ThreeWayTextMergeImplementation.html"><strong aria-hidden="true">7.13.</strong> ThreeWayTextMergeImplementation</a></li><li class="chapter-item expanded "><a href="UserModel.html"><strong aria-hidden="true">7.14.</strong> UserModel</a></li><li class="chapter-item expanded "><a href="Weave.html"><strong aria-hidden="true">7.15.</strong> Weave</a></li><li class="chapter-item expanded "><a href="WikiNode.html"><strong aria-hidden="true">7.16.</strong> WikiNode</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Revision Control</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/tonyg/revctrl.org/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="operational-transformation"><a class="header" href="#operational-transformation">Operational Transformation</a></h1>
<p>Operational Transformation is a theory very similar to the Darcs Theory of Patches (see <a href="DarcsMerge.html">DarcsMerge</a>).  It has been developed by the collaborative editing community.</p>
<p>In collaborative editing, much less emphasis is placed on conflict marking (they don't bother with it).  Conflicts occur at a much more fine-grained level than in revision control (e.g. keypresses) and at the place that both users are currently working in real time.  This means that each user should see the other making changes in the same area, and use a mechanism other than the editing system to coordinate.  Conflict resolution just has to ensure consistency, and can otherwise do pretty much anything, as long as it is automatic.</p>
<p>A document starts empty.  Each user then begins transforming it.  Those transformations are concurrently sent to other users.  However, with multiple machines, these messages might be received in different orders by different users.  Ressel et. al. (in Proceedings of the ACM Conference on Computer Supported Cooperative Work 1996) proved some properties that must apply so that when all messages are eventually received and processed, all copies of the document are identical.  From these two properties, you can show correctness (for their definition of correctness).</p>
<h2 id="definitions"><a class="header" href="#definitions">Definitions</a></h2>
<p>An <em>operation</em> is a modification of a document.  e.g. the addition of a character at a particular position in the document because of a keypress.</p>
<p>A <em>transformation function</em> is a function, <code>T</code>, that merges two parallel operations by serialising them.  This is similar to the <code>||</code>-merge operation in Darcs, or the exact <a href="ThreeWayTextMergeImplementation.html">ThreeWayTextMergeImplementation</a>.  <code>T(op1, op2)</code> returns an operation that is the 'same' as op1 but changed so that it can be applied after op2.</p>
<p>Composition is expressed as <code>.</code>: <code>op1 . op2</code> means to apply <code>op1</code>, and then apply <code>op2</code> to the result.  We also define <code>T(opx, opy . opz) = T(T(opx, opy), opz)</code>.  This says that to transform <code>opx</code> through a pair of operations, <code>opy.opz</code>, you first transform <code>opx</code> through <code>opy</code>, and then you transform the result of that through <code>opz</code>.</p>
<h3 id="example"><a class="header" href="#example">example</a></h3>
<p>A standard merge looks as below.  We have one initial context, <code>a</code>, and two changes, <code>op1</code> and <code>op2</code> that both apply to <code>a</code>.  Each of <code>op1</code> and <code>op2</code> can be passed through the transformation function <code>T</code> to get <code>op1' = T(op1, op2)</code> and <code>op2' = T(op2, op1)</code>.</p>
<pre><code>      a
     / \
op1 /   \ op2
   /     \
  b       c
   \     /
op2'\   / op1'
     \ /
      d
</code></pre>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<p>TP1: For every two concurrent operations, <code>op1</code> and <code>op2</code>, defined on the same state, the transformation function <code>T</code> must satisfy:</p>
<pre><code>op1 . T(op2, op1) == op2 . T(op1, op2)
</code></pre>
<p>In the above example, this is requirement that <code>op1 . op2' == op2 . op1'</code>.  <code>d</code> is consistent regardless of which way around the merge is performed.  This is what the above example shows.</p>
<p>TP2: For every three concurrent operations, <code>op1</code>, <code>op2</code> and <code>op3</code>, defined on the same state, the transformation function <code>T</code> must satisfy:</p>
<pre><code>T(op3, op1 . T(op2, op1)) == T(op3, op2 . T(op1, op2))
</code></pre>
<p>or equivalently:</p>
<pre><code>T(T(op3,op1),T(op2,op1)) == T(T(op3,op2),T(op1,op2))
</code></pre>
<h3 id="example-1"><a class="header" href="#example-1">example</a></h3>
<p>Start with the previous example where there are two parallel operations, <code>op1</code> and <code>op2</code>.  Property TP1 says that which op you choose to transform to serialise them doesn't matter.  This gives us the <em>abcd</em> diamond of states which again appears below.  Property TP2 goes one step further and says that the way you serialise a third operation, <code>op3</code>, through the other two doesn't matter either.  We could transform <code>op3</code> through <code>op1</code> and then <code>op2'</code>, or we could transform <code>op3</code> through <code>op2</code> and then <code>op1'</code>.  The result should be the same.</p>
<pre><code>op1' = T(op1, op2)
op2' = T(op2, op1)
op3'a = T(op3, op1)
op3'b = T(op3, op2)
op3''a = T(op3'a, op2')
op3''b = T(op3'b, op1')

                    a--------
                   / \       \
              op1 /   \ op2   \ op3
                 /     \       \
            ----b       c----   e
           /     \     /     \
    op3'a /  op2' \   / op1'  \ op3'b
         /         \ /         \
        g           d           h
                   / \
            op3''a | | op3''b
                   \ /
                    f
</code></pre>
<h2 id="ressels-transformation-functions"><a class="header" href="#ressels-transformation-functions">Ressel's Transformation Functions</a></h2>
<p>These are some proposed operators for collaborative editing, and a proposed transformation function.  I mention them here because they are similar to exact three-way-merge, and yet can be shown NOT to satisfy the above properties.</p>
<p>In this formalism, priorities are fixed attributes of the user than makes the change.  They are used to resolve conflicts (it allows both changes to be made in the order defined by the priorities).</p>
<p>There are two operations:</p>
<p><code>Ins(p, c, pr)</code> inserts character <code>c</code> at position <code>p</code> with priority <code>pr</code>.  <code>Del(p, pr)</code> deletes the character at location <code>p</code> with priority <code>pr</code>.</p>
<p>And the definition of the transformation function is relatively straight forward:</p>
<pre><code>T(Ins(p1, c1, u1), Ins(p2, c2, u2)) :-
   if (p1 &lt; p2) or (p1 == p2 and u1 &lt; u2) return Ins(p1, c1, u1)
   else return Ins(p1 + 1, c1, u1)

T(Ins(p1, c1, u1), Del(p2, u2)) :-
   if (p1 &lt;= p2) return Ins(p1, c1, u1)
   else return Ins(p1 - 1, c1, u1)

T(Del(p1, u1), Ins(p2, c2, u2)) :-
   if (p1 &lt; p2) return Del(p1, u1)
   else return Del(p1 + 1, u1)

T(Del(p1, u1), Del(p2, u2)) :-
   if (p1 &lt; p2) return Del(p1, u1)
   else if (p1 &gt; p2) return Del(p1 - 1, u1)
   else return Id()
</code></pre>
<p>The counter example of TP2 (from [http://hal.inria.fr/inria-00071213 Proving correctness of transformation functions in collaborative editing systems] by Oster et. al., but with typesetting errors corrected):</p>
<pre><code>
   Site 1              Site 2              Site 3

   &quot;abc&quot;               &quot;abc&quot;               &quot;abc&quot;

op1 = ins(3,x)     op2 = del(2)        op3 = ins(2,y)

  &quot;abxc&quot;               &quot;ac&quot;                &quot;aybc&quot;

                   op3' = ins(2,y)     op2' = del(3)

                       &quot;ayc&quot;               &quot;ayc&quot;

                   op1' = ins(2,x)     op1'' = ins(3,x)

                       &quot;axyc&quot;              &quot;ayxc&quot;

</code></pre>
<h2 id="tombstone-transformation-functions"><a class="header" href="#tombstone-transformation-functions">Tombstone Transformation Functions</a></h2>
<p>Having shown other systems incorrect, Oster et. al. then go on to describe the Tombstone Transformation Functions, or TTF.  In version control parlance, this is a weave (see <a href="SimpleWeaveMerge.html">SimpleWeaveMerge</a>).  No characters are ever deleted, but rather they are marked invisible (these invisible characters are the 'tombstones').  Ordering ties are broken by user-ID.  They show that this system satisfies TP2 when many other systems do not.</p>
<h2 id="strengths"><a class="header" href="#strengths">Strengths</a></h2>
<p>Can provably merge correctly.</p>
<h2 id="weaknesses"><a class="header" href="#weaknesses">Weaknesses</a></h2>
<p>Does not mark conflicts at all.</p>
<h2 id="used-by"><a class="header" href="#used-by">Used by</a></h2>
<ul>
<li>A good summary paper is available from INRIA: http://hal.inria.fr/inria-00071213</li>
<li>The [http://dev.libresource.org/home/doc/so6-user-manual so6 revision control system] (pronounced saucisse)</li>
</ul>
<h2 id="related"><a class="header" href="#related">Related</a></h2>
<p>Operational Transformation theory is related to Darcs theory of patches.  Darcs is based on commuting patches:</p>
<pre><code>op1.op2 &lt;-&gt; op2'.op1'
</code></pre>
<p>As described in [http://www.abridgegame.org/pipermail/darcs-users/2003/000221.html this thread], this effect can be achieved using the OT transformation operator as long as you can invert an operation.  We'll define <code>Inv(op)</code> to be another operation that has the opposite effect of <code>op</code>.  This means that <code>Inv(op).op</code> is the identity.  <code>Inv(op)</code> is both a left and a right inverse, so <code>op.Inv(op)</code> is also the identity.</p>
<p>We can then define the commuted op1 and op2, those being op1' and op2', as:</p>
<pre><code>op2' = T(op2, Inv(op1))
op1' = T(op1, op2')
</code></pre>
<p>Rather than inverting operators, it is also possible to view this as having an inverse Transformation function, <code>T⁻¹</code>.  Imagine <code>opA</code> and <code>opB</code> are parallel ops that need to be merged; then we get <code>opB' = T(opB, opA)</code>.  And then <code>opB = T⁻¹(opB', opA)</code>.  The commutation of <code>op1</code> and <code>op2</code> then becomes:</p>
<pre><code>op2' = T-1(op2, op1)
op1' = T(op1, op2')
</code></pre>
<p><a href="http://hal.inria.fr/inria-00109039/en/">This paper</a> describes partial <code>T⁻¹</code> functions for the tombstone transformation operators.</p>
<hr />
<p><a href="CategoryMergeAlgorithm.html">CategoryMergeAlgorithm</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="DieDieDieMerge.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="ScalarMerge.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="DieDieDieMerge.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="ScalarMerge.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
